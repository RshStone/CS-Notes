# 重构

前言：作为一个软件开发工程师，你的一天有多少时间在努力写出好的代码呢？

新的工具和中间件曾不出穷。 

而好的代码就像是一个艺术品



## 第3章 代码的坏味道

![企业微信截图_a792ae08-fa29-4126-81c9-985f791ea541](/Users/zhiwen.shithoughtworks.com/Library/Containers/com.tencent.WeWorkMac/Data/Documents/Profiles/AEC2770FFCC3AC4BC5EC69A4F3EA4E79/Caches/Images/2022-11/d1f4b8d231d90182d9380d8d7302544a_HD/企业微信截图_a792ae08-fa29-4126-81c9-985f791ea541.png)

“如果尿布臭了，就换掉它。”

  ——语出Beck奶奶，论保持小孩清洁的哲学”

“味道与重构手法速查表”



### 3.1 “神秘命名（Mysterious Name）”

命名很难

“好的名字能节省未来用在猜谜上的大把时间。”

### 3.2　重复代码（Duplicated Code）

**最简单的例子：**

“同一个类的两个函数含有相同的表达式”

### 3.3 “过长函数（Long Function）”

长的函数改成小的函数

“据我们的经验，活得最长、最好的程序，其中的函数都比较短。初次接触到这种代码库的程序员常常会觉得“计算都没有发生”——程序里满是无穷无尽的委托调用。但和这样的程序共处几年之后，你就会明白这些小函数的价值所在。间接性带来的好处——更好的阐释力、更易于分享、更多的选择——都是由小函数来支持的。”

**一个写代码的变化**

“在早期的编程语言中，子程序调用需要额外开销，这使得人们不太乐意使用小函数。现代编程语言几乎已经完全免除了进程内的函数调用开销。固然，小函数也会给代码的阅读者带来一些负担，因为你必须经常切换上下文，才能看明白函数在做什么。但现代的开发环境让你可以在函数的调用处与声明处之间快速跳转，或是同时看到这两处，让你根本不用来回跳转。不过说到底，让小函数易于理解的关键还是在于良好的命名。如果你能给函数起个好名字，阅读代码的人就可以通过名字了解函数的作用，根本不必去看其中写了些什么。”

在程序，子程序需要额外进程函数调用开销。 **ps：可以学习OSTEP进程调度章节**

｜｜

  V

1：IDEA 在函数调用声明快速跳转 2: 小函数起的名字起的名字容易懂



### “3.4　过长参数列表（Long Parameter List）

 编程传入参数 VS 设置全局变量    问题： 参数列表过长｜全局变量导致一些问题（堆存储过大等） **ps：**java中存储在方法区

**如何改善：**

“向某个参数发起查询而获得另一个参数的值，那么就可以使用以查询取代参数（324）去掉这第二个参数”

“有几项参数总是同时出现，可以用引入参数对象（140）将其合并成一个对象”

### “3.5　全局数据（Global Data）

  “全局数据仍然是最刺鼻的坏味道之一。全局数据的问题在于，从代码库的任何一个角落都可以修改它，而且没有任何机制可以探测出到底哪段代码做出了修改。一次又一次，全局数据造成了那些诡异的bug，”

**如何优化：**

“防御手段是封装变量（132），每当我们看到可能被各处的代码污染的数据，这总是我们应对的第一招。你把全局数据用一个函数包装起来，至少你就能看见修改它的地方，并开始控制对它的访问。随后，最好将这个函数（及其封装的数据）搬移到一个类或模块中，只允许模块内的代码使用它，从而尽量控制其作用域。

###  “3.6　可变数据（Mutable Data）”

“对数据的修改经常导致出乎意料的结果和难以发现的bug。我在一处更新数据，却没有意识到软件中的另一处期望着完全不同的数据，于是一个功能失效了——如果故障只在很罕见的情况下发生，要找出故障原因就会更加困难。因此，有一整个软件开发流派——函数式编程——完全建立在“数据永不改变”的概念基础上：如果要更新一个数据结构，就返回一份新的数据副本，旧的数据仍保持不变。”

Excerpt From
重构：改善既有代码的设计（第2版）
马丁·福勒(Martin Fowler)
This material may be protected by copyright.

Excerpt From
重构：改善既有代码的设计（第2版）
马丁·福勒(Martin Fowler)
This material may be protected by copyright.

### “3.12　重复的switch （Repeated Switches）”

“如果你跟真正的面向对象布道者交谈，他们很快就会谈到switch语句的邪恶。在他们看来，任何switch语句都应该用以多态取代条件表达式（272）消除掉。我们甚至还听过这样的观点：所有条件逻辑都应该用多态取代，绝大多数if语句都应该被扫进历史的垃圾桶。

  ”

Excerpt From
重构：改善既有代码的设计（第2版）
马丁·福勒(Martin Fowler)
This material may be protected by copyright.

Excerpt From
重构：改善既有代码的设计（第2版）
马丁·福勒(Martin Fowler)
This material may be protected by copyright.